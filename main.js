(()=>{"use strict";var t={56(t,e,n){t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72(t){var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var s={},r=[],a=0;a<t.length;a++){var l=t[a],d=i.base?l[0]+i.base:l[0],h=s[d]||0,p="".concat(d," ").concat(h);s[d]=h+1;var c=n(p),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==c)e[c].references++,e[c].updater(u);else{var b=o(u,i);i.byIndex=a,e.splice(a,0,{identifier:p,updater:b,references:1})}r.push(p)}return r}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var s=i(t=t||[],o=o||{});return function(t){t=t||[];for(var r=0;r<s.length;r++){var a=n(s[r]);e[a].references--}for(var l=i(t,o),d=0;d<s.length;d++){var h=n(s[d]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}s=l}}},113(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n}).join("")},e.i=function(t,n,i,o,s){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var d=0;d<t.length;d++){var h=[].concat(t[d]);i&&r[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),e.push(h))}},e}},523(t,e,n){n.d(e,{A:()=>a});var i=n(601),o=n.n(i),s=n(314),r=n.n(s)()(o());r.push([t.id,"*, *::before, *::after {\n    padding: 0;\n    margin: 0;\n    box-sizing: border-box;\n}\n\nhtml, body {\n    height: 100%;\n    padding: 0;\n}\n\nbody {\n    display: flex;\n    flex-direction: column;\n    justify-content: start;\n    align-items: start;\n\n    background-color: white;\n}\n\nheader {\n    --header-height: 60px;\n\n    position: relative;\n    width: 100%;\n    height: var(--header-height);\n    min-height: var(--header-height);\n\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\nheader > #title {\n    color: #303030;\n    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 600;\n    font-size: 1.5rem;\n    text-decoration: none;\n}\n\nmain {\n    flex: 1;\n    width: 100%;\n    padding: 2rem;\n    padding-top: 2rem;\n    padding-bottom: 4rem;\n\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n}\n\n#game {\n    height: fit-content;\n    width: 800px;\n    max-width: 100%;\n\n    margin-top: -32px;\n\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n@media (width <= 900px) {\n    #game {\n        flex-direction: column;\n        justify-content: start;\n        align-items: center;\n        gap: 3rem;\n    }\n\n    main {\n        padding-top: calc(2rem + 60px);\n    }\n}\n\n@media (height <= 500px) {\n    main {\n        padding-top: calc(2rem + 60px);\n    }\n}\n\n.board-wrapper {\n    width: 100%;\n    max-width: 350px;\n    min-width: 200px;\n    aspect-ratio: 1;\n    overflow: visible;\n    position: relative;\n}\n\n.board {\n    width: 100%;\n    height: 100%;\n\n    border-collapse: collapse;\n    border-style: solid;\n\n    border-width: 1px;\n    border-color: rgb(255, 130, 0, 0.4);\n\n    position: relative;\n    overflow: visible;\n}\n\n.board td {\n    border-width: 1px;\n    border: 1px solid rgb(180,180,255);\n}\n\n.tile {\n    width: 100%;\n    height: 100%;\n    position: relative;\n\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-size: 0.8rem;\n\n    transition: background-color 0.05s ease-out;\n}\n.tile[selectable]:hover {\n    cursor: pointer;\n    background-color: rgb(180, 180, 255, 0.2);\n}\n.tile[selectable]:active {\n    background-color: rgb(180, 180, 255, 0.4);\n}\n\n.marker-left {\n    position: absolute;\n    right: calc(100% + 12px);\n    top: 50%;\n    translate: 0% -50%;\n    user-select: none;\n}\n\n.marker-top {\n    position: absolute;\n    bottom: calc(100% + 8px);\n    left: 50%;\n    translate: -50% 0%;\n    user-select: none;\n}\n\n.board-ships {\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: visible;\n}\n\n.ship {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n\n    box-sizing: border-box;\n    border: 1px solid rgb(255, 130, 0);\n    outline: 1px solid rgb(255, 130, 0);\n    background-color: rgb(255, 130, 0, 0.3);\n    z-index: 1000;\n\n    touch-action: none;\n}\n\n.ship:hover {\n    background-color: rgb(255, 130, 0, 0.4);\n}\n.ship[movable]:hover {\n    cursor: grab;\n}\n.ship[movable].dragging {\n    cursor: grabbing;\n    background-color: rgb(255, 130, 0, 0.5);\n    z-index: 1001;\n}\n.ship[movable].snapping {\n    border: 2px solid rgb(50,255,50);\n    outline: 1px solid rgb(50,255,50);\n    background-color: rgb(50,255,50,0.2);\n    z-index: 1001;\n}\n\n@keyframes shake {\n  from, to {\n    -webkit-transform: translate3d(0, 0, 0);\n    transform: translate3d(0, 0, 0);\n\n  }\n\n  10%, 30%, 50%, 70%, 90% {\n    -webkit-transform: translate3d(-2px, 0, 0);\n    transform: translate3d(-2px, 0, 0);\n\n  }\n\n  20%, 40%, 60%, 80% {\n    -webkit-transform: translate3d(2px, 0, 0);\n    transform: translate3d(2px, 0, 0);\n\n  }\n}\n\n.ship.error {\n    animation-duration: 0.5s;\n    animation-iteration-count: once;\n    animation-name: shake;\n    border: 2px solid rgb(255,50,50);\n    outline: 1px solid rgb(255,50,50);\n    background-color: rgb(255,50,50,0.2);\n}\n\n#board-play {\n    position: absolute;\n    top: -20px;\n    left: -26px;\n    width: calc(100% + 52px);\n    height: calc(100% + 30px);\n    z-index: 1002;\n\n    background-color: rgb(255,255,255,0.7);\n    backdrop-filter: grayscale(60%);\n}\n\n#board-play button {\n    position: relative;\n    top: 50%;\n    left: 50%;\n    translate: -50% -50%;\n\n    border: none;\n    border-radius: 8px;\n    font-size: 1.5rem;\n\n    width: 180px;\n    height: 70px;\n\n    background-color: hsl(170deg 100% 27.5%);\n    font-weight: 600;\n    color: white;\n    font-family: monospace;\n    box-shadow: 0px 2px 5px rgb(0,0,0,0.4);\n\n    transition: scale 0.075s ease-out;\n}\n#board-play button:hover {\n    cursor: pointer;\n    background-color: hsl(170deg 100% 30.0%);\n}\n#board-play button:active {\n    background-color: hsl(170deg 100% 32.5%);\n    scale: 0.96;\n}\n\n.board-info {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    position: absolute;\n    top: calc(100% + 4px);\n    left: 50%;\n    translate: -50% 0%;\n    text-align: center;\n}\n.board-info-player {\n    font-weight: 600;\n    font-size: 1.25rem;\n}\n\n.board-hits {\n    position: absolute;\n    left: 0;\n    top: 0;\n    overflow: visible;\n}\n.hit {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n\n    outline: 1px solid red;\n    background-color: blue;\n    z-index: 1003;\n\n    scale: 0.0;\n    transition: scale 0.2s ease-in-out;\n\n    clip-path: polygon(20% 0%, 0% 20%, 30% 50%, 0% 80%, 20% 100%, 50% 70%, 80% 100%, 100% 80%, 70% 50%, 100% 20%, 80% 0%, 50% 30%);\n}\n.hit[visible] {\n    scale: 0.8;\n}\n.hit[hit] {\n    background-color: red;\n}\n\nhtml:has(#modal-div[open]), body:has(#modal-div[open]) {\n    overflow: hidden;\n}\n#modal-div {\n    z-index: 2001;\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100dvw;\n    height: 100dvh;\n    background-color: transparent;\n    padding: 2rem;\n\n    display: grid;\n    place-items: center;\n\n    overflow: auto;\n    pointer-events: none;\n}\n#modal-div[open] {\n    pointer-events: all;\n}\n#modal-backdrop {\n    --transition_dur: 0.2s;\n\n    pointer-events: none;\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100dvw;\n    height: 100dvh;\n    background-color: rgb(0,0,0,0.2);\n    opacity: 0;\n    transition: opacity var(--transition_dur) ease-in-out;\n}\n#modal-backdrop[open] {\n    pointer-events: all;\n    opacity: 1;\n}\n.modal {\n    position: relative;\n    --transition_dur: 0.2s;\n\n    width: 100%;\n    max-width: 400px;\n    min-width: 200px;\n    height: fit-content;\n\n    pointer-events: none;\n    background-color: white;\n\n    border-radius: 1rem;\n    padding: 1rem;\n\n    translate: 0px 30px;\n    opacity: 0;\n    scale: 0.85;\n    transition: \n        translate var(--transition_dur) ease-in-out, \n        scale var(--transition_dur) ease-in-out, \n        opacity var(--transition_dur) ease-in-out;\n\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-size: 1.5rem;\n\n    grid-row: 1;\n    grid-column: 1;\n}\n.modal[open] {\n    pointer-events: all;\n    opacity: 1;\n    translate: 0px 0px;\n    scale: 1;\n}\n.modal-title {\n    position: absolute;\n    top: 0;\n    left: 50%;\n    translate: -50% -50%;\n\n    background-color: #303030;\n    padding: 8px;\n    border-radius: 10px;\n    font-size: 1rem;\n\n    font-size: 1.5rem;\n    font-weight: 600;\n    color: white;\n}\n#modal-gameover-info {\n    margin-top: 16px;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-size: 1.2rem;\n    font-weight: 500;\n    color: #303030;\n\n    text-align: center;\n    line-height: 1.75;\n}\n.modal-ok {\n    background-color: hsl(170deg 100% 27.5%);\n    border: none;\n    border-radius: 8px;\n    width: 100%;\n    height: 70px;\n    margin-top: 16px;\n    color: white;\n    font-family: monospace;\n    font-size: 1.6rem;\n    font-weight: 600;\n    transition: scale 0.075s ease-out;\n    scale: 1;\n}\n.modal-ok:hover {\n    cursor: pointer;\n    background-color: hsl(170deg 100% 30.0%);\n}\n.modal-ok:active {\n    background-color: hsl(170deg 100% 32.5%);\n    scale: 0.96;\n}\n\n#board-randomize {\n    border-radius: 8px;\n    position: absolute;\n    top: calc(100% + 10px);\n    left: 0px;\n    width: 40px;\n    height: 40px;\n    border: 1px solid #aaaaaa;\n    background-color: rgb(247,247,247);\n    font-size: 1.1rem;\n}\n#board-randomize:hover {\n    cursor: pointer;\n    background-color: rgb(240,240,240);\n}\n#board-randomize:active {\n    background-color: rgb(233,233,233);\n}\n#board-randomize:disabled {\n    cursor: not-allowed;\n    border: 1px solid #aaaaaa;\n}\n\n#button-info {\n    position: absolute;\n    right: 16px;\n    top: 50%;\n    translate: 0 -50%;\n    width: 40px;\n    height: 40px;\n    border-radius: 8px;\n    border: 1px solid #cccccc;\n    background-color: rgb(247,247,247);\n    font-size: 1.1rem;\n}\n#button-info:hover {\n    cursor: pointer;\n    background-color: rgb(240,240,240);\n}\n#button-info:active {\n    background-color: rgb(233,233,233);\n}\n\n#modal-info {\n    max-width: 450px;\n}\n#modal-info-info {\n    margin-top: 15px;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-size: 1.2rem;\n    font-weight: 500;\n    color: #303030;\n\n    text-align: center;\n    line-height: 1.75;\n}\n\n#div-vs {\n    font-size: 1.25rem;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    font-weight: 500;\n    margin-right: 8px;\n    margin-top: 16px;\n}",""]);const a=r},540(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601(t){t.exports=function(t){return t[1]}},659(t){var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var s=e[i]={id:i,exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;var i=n(72),o=n.n(i),s=n(825),r=n.n(s),a=n(659),l=n.n(a),d=n(56),h=n.n(d),p=n(540),c=n.n(p),u=n(113),b=n.n(u),m=n(523),f={};f.styleTagTransform=b(),f.setAttributes=h(),f.insert=l().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=c(),o()(m.A,f),m.A&&m.A.locals&&m.A.locals;class g{constructor(t,e,n,i){this.ship_len=t,this.position=e,this.to_right=n,this.hp=t,this.id=i}doesInclude(t){if(this.to_right){const e=t[0]-this.position[0];return t[1]===this.position[1]&&e>=0&&e<this.ship_len}const e=t[1]-this.position[1];return t[0]===this.position[0]&&e>=0&&e<this.ship_len}getPositions(){let t=[];if(this.to_right)for(let e=this.position[0];e<this.position[0]+this.ship_len;e++)t.push([e,this.position[1]]);else for(let e=this.position[1];e<this.position[1]+this.ship_len;e++)t.push([this.position[0],e]);return t}isDestroyed(){return 0===this.hp}}class v{constructor(t){this.ship_amount=t}}class y{constructor(t=[]){this.ships=t,this.hits=[]}reset(){this.hits=[];for(const t of this.ships)t.hp=t.ship_len}hit(t){let e=!1;for(let n of this.ships){const i=n.getPositions();for(const o of i)if(t[0]==o[0]&&t[1]==o[1]){n.hp-=1,e=!0;break}if(e)break}this.hits.push({is_hit:e,position:t})}areAllShipsDestroyed(){for(const t of this.ships)if(!t.isDestroyed())return!1;return!0}randomize(t){this.ships=[],this.#t(t)}#t(t){let e=0;for(let n=t.ship_amount.length-1;n>=0;n--)if(t.ship_amount[n]>0){e=n+1;break}if(e<=0)return!0;const n=this.getMaxShipId()+1,i=[];for(let t=0;t<10;t++)for(let o=0;o<10;o++)this.ships.push(new g(e,[o,t],!0,n)),this.isValidState()&&i.push([t,o,!0]),this.ships.pop(),e>1&&(this.ships.push(new g(e,[o,t],!1,n)),this.isValidState()&&i.push([t,o,!1]),this.ships.pop());for(;;){if(0==i.length)return!1;const o=Math.floor(Math.random()*i.length),s=i[o];if(this.ships.push(new g(e,[s[1],s[0]],s[2],n)),t.ship_amount[e-1]=t.ship_amount[e-1]-1,this.#t(t))return t.ship_amount[e-1]=t.ship_amount[e-1]+1,!0;i.splice(o,1),t.ship_amount[e-1]=t.ship_amount[e-1]+1,this.ships.pop()}}getBoard(){let t=[];for(let e=0;e<10;e++){t.push([]);for(let n=0;n<10;n++)t[e].push(0)}for(let e of this.ships){const n=e.getPositions();for(let i of n)t[i[1]][i[0]]=e.id}return t}isValidState(){const t=[];for(let e=0;e<10;e++){t.push([]);for(let n=0;n<10;n++)t[e].push(0)}for(let e of this.ships){let n=e.getPositions();for(const i of n){if(i[0]<0||i[1]<0||i[0]>=10||i[1]>=10)return!1;if(0!=t[i[1]][i[0]])return!1;t[i[1]][i[0]]=e.id;for(let e=-1;e<=1;e++)for(let n=-1;n<=1;n++){if(0==e&&0==n)continue;const o=i[1]+e,s=i[0]+n;if(!(o<0||s<0||o>=10||s>=10)&&0!=t[o][s]&&t[o][s]!=t[i[1]][i[0]])return!1}}}return!0}isPossibleToMoveShip(t,e){const n=[];for(const i of this.ships)n.push(new g(i.ship_len,i.id===t?e.slice():i.position,i.to_right,i.id));return new y(n).isValidState()}isPossibleToRotateShip(t){const e=[];for(const n of this.ships)e.push(new g(n.ship_len,n.position,n.id===t?!n.to_right:n.to_right,n.id));return new y(e).isValidState()}moveShip(t,e){for(let n=0;n<this.ships.length;n++)if(this.ships[n].id==t)return void(this.ships[n].position=e.slice())}rotateShip(t){for(let e=0;e<this.ships.length;e++)if(this.ships[e].id==t)return void(this.ships[e].to_right=!this.ships[e].to_right)}getShipPosition(t){for(let e=0;e<this.ships.length;e++)if(this.ships[e].id==t)return this.ships[e].position.slice()}getMaxShipId(){let t=0;for(const e of this.ships)e.id>t&&(t=e.id);return t}}class x{static event_to_callbacks=new Map;static subscribe(t,e){const n=x.event_to_callbacks.get(t);n?n.push(e):x.event_to_callbacks.set(t,[e])}static publish(t,e){const n=[],i=x.event_to_callbacks.get(t);if(!i)return[];for(let t=0;t<i.length;t++)n.push(i[t](e));return n}}class S{constructor(t,e,n){this.id=t,this.is_computer=e,this.gameboard=n,this.turn=1}selectHit(t){const e=[];for(let t=0;t<10;t++){e.push([]);for(let n=0;n<10;n++)e[t].push(!1)}for(const n of t.hits)e[n.position[1]][n.position[0]]=!0;const n=[];for(let t=0;t<10;t++)for(let i=0;i<10;i++)e[t][i]||n.push([t,i]);return n[Math.floor(Math.random()*n.length)]}}class _{static STATES={START_STATE:0,BOARD_CHOICE:1,PLAYER1_TURN:2,PLAYER2_TURN:3,GAMEOVER:4,STATE_AMOUNT:5};static state=this.STATES.START_STATE;static enterStateCallbacks=[];static leaveStateCallbacks=[];static init(){for(let t=0;t<this.STATES.STATE_AMOUNT;t++)this.enterStateCallbacks.push([]),this.leaveStateCallbacks.push([])}static addEnterCallback(t,e){this.enterStateCallbacks[t].push(e)}static addLeaveCallback(t,e){this.leaveStateCallbacks[t].push(e)}static changeState(t){if(t===this.state)return;const e=this.state;this.state=t;for(const t of this.leaveStateCallbacks[Number(e)])t();for(const e of this.enterStateCallbacks[Number(t)])e()}}_.init(),new class{constructor(){this.global_modal=null,this.modal_div=document.getElementById("modal-div"),this.modal_backdrop=document.getElementById("modal-backdrop");const t=document.getElementById("modal-gameover"),e=document.getElementById("modal-gameover-ok"),n=document.getElementById("modal-gameover-info"),i=document.getElementById("button-info"),o=document.getElementById("modal-info"),s=document.getElementById("modal-info-ok"),r=document.getElementById("board-play"),a=document.querySelector("#board-play > button"),l=document.querySelector("#board-1 .board"),d=(document.querySelector("#board-2 .board"),document.querySelector("#board-1 .board-ships")),h=document.querySelector("#board-2 .board-ships"),p=document.querySelector("#board-1 .board-hits"),c=document.querySelector("#board-2 .board-hits"),u=document.querySelector("#board-1 .board-info-player"),b=document.querySelector("#board-2 .board-info-player"),m=document.querySelector("#board-1 .board-info-turn"),f=document.querySelector("#board-2 .board-info-turn"),g=document.getElementById("board-randomize"),v=(l.getBoundingClientRect().width,[]),y=[],S=[],w=[],T=[];for(let t=0;t<10;t++)v.push([]),y.push([]),S.push([]),w.push([]),T.push([]);for(let t=0;t<10;t++)for(let e=0;e<10;e++){v[t].push(document.querySelector(`#board-1 td[data-y="${t+1}"][data-x="${e+1}"] > div.tile`)),y[t].push(document.querySelector(`#board-2 td[data-y="${t+1}"][data-x="${e+1}"] > div.tile`)),S[t].push(()=>{_.state===_.STATES.PLAYER1_TURN&&x.publish("select_player1",{i:t,j:e})});const n=document.createElement("div");n.classList.add("hit"),w[t].push(n.cloneNode()),T[t].push(n.cloneNode()),p.appendChild(w[t][e]),c.appendChild(T[t][e])}a.addEventListener("click",()=>{r.style.display="none",_.changeState(_.STATES.PLAYER1_TURN)}),g.addEventListener("click",()=>{x.publish("randomize")}),this.modal_backdrop.addEventListener("click",()=>{this.global_modal!==t&&this.closeModal()}),e.addEventListener("click",()=>{this.closeModal(),_.changeState(_.STATES.BOARD_CHOICE)}),s.addEventListener("click",()=>{this.closeModal()}),i.addEventListener("click",()=>{this.openModal(o)}),_.addEnterCallback(_.STATES.BOARD_CHOICE,()=>{for(let t=0;t<y.length;t++)for(let e=0;e<y[t].length;e++)y[t][e].removeEventListener("click",S[t][e]),y[t][e].addEventListener("click",S[t][e]),w[t][e].removeAttribute("visible"),T[t][e].removeAttribute("visible");r.style.display="block",u.style.color="black",b.style.color="black",g.removeAttribute("disabled")}),_.addLeaveCallback(_.STATES.BOARD_CHOICE,()=>{g.setAttribute("disabled","")}),_.addEnterCallback(_.STATES.PLAYER1_TURN,()=>{for(let t=0;t<y.length;t++)for(let e=0;e<y[t].length;e++)y[t][e].setAttribute("selectable","");u.style.color="red",b.style.color="black"}),_.addEnterCallback(_.STATES.PLAYER2_TURN,()=>{for(let t=0;t<y.length;t++)for(let e=0;e<y[t].length;e++)y[t][e].removeAttribute("selectable");u.style.color="black",b.style.color="red"}),x.subscribe("remove-board-callback",({i:t,j:e})=>{y[t][e].removeEventListener("click",S[t][e])}),x.subscribe("refresh",t=>{for(m.innerHTML=`Turn ${t.player1.turn}`,f.innerHTML=`Turn ${t.player2.turn}`;d.firstChild;)d.removeChild(d.firstChild);for(;h.firstChild;)h.removeChild(h.firstChild);const e=(l.getBoundingClientRect().width-11)/10;for(const n of t.player1.gameboard.ships){const t=document.createElement("div");t.classList.add("ship"),t.dataset.id=n.id,_.state==_.STATES.BOARD_CHOICE&&t.setAttribute("movable","");const i=e*n.ship_len+1*(n.ship_len-1);n.to_right?(t.style.width=`${i}px`,t.style.height=`${e}px`):(t.style.width=`${e}px`,t.style.height=`${i}px`),t.style.left=n.position[0]*e+1*(n.position[0]+1)+"px",t.style.top=n.position[1]*e+1*(n.position[1]+1)+"px",d.appendChild(t)}for(const n of t.player1.gameboard.hits){const t=w[n.position[1]][n.position[0]];t.style.width=`${e}px`,t.style.height=`${e}px`,t.style.left=n.position[0]*e+1*(n.position[0]+1)+"px",t.style.top=n.position[1]*e+1*(n.position[1]+1)+"px",t.hasAttribute("visible")||t.setAttribute("visible",""),n.is_hit?t.setAttribute("hit",""):t.removeAttribute("hit")}for(const n of t.player2.gameboard.ships){if(!n.isDestroyed())continue;const t=document.createElement("div");t.classList.add("ship"),t.dataset.id=n.id,_.state==_.STATES.BOARD_CHOICE&&t.setAttribute("movable","");const i=e*n.ship_len+1*(n.ship_len-1);n.to_right?(t.style.width=`${i}px`,t.style.height=`${e}px`):(t.style.width=`${e}px`,t.style.height=`${i}px`),t.style.left=n.position[0]*e+1*(n.position[0]+1)+"px",t.style.top=n.position[1]*e+1*(n.position[1]+1)+"px",h.appendChild(t)}for(const n of t.player2.gameboard.hits){const t=T[n.position[1]][n.position[0]];t.style.width=`${e}px`,t.style.height=`${e}px`,t.style.left=n.position[0]*e+1*(n.position[0]+1)+"px",t.style.top=n.position[1]*e+1*(n.position[1]+1)+"px",t.hasAttribute("visible")||t.setAttribute("visible",""),n.is_hit?t.setAttribute("hit",""):t.removeAttribute("hit")}}),this.activeShip=null,this.activeShipPos=null,this.offsetX=0,this.offsetY=0,this.moved=!1,document.addEventListener("pointerdown",t=>{if(_.state!=_.STATES.BOARD_CHOICE)return;const e=t.target.closest("#board-1 .ship");if(!e)return;e.setPointerCapture(t.pointerId),this.activeShip=e,e.classList.add("dragging"),this.activeShipPos=x.publish("get-position",Number(e.dataset.id))[0].slice();const n=e.getBoundingClientRect();this.offsetX=t.clientX-n.left,this.offsetY=t.clientY-n.top,this.moved=!1}),document.addEventListener("pointermove",t=>{if(_.state!=_.STATES.BOARD_CHOICE)return;if(!this.activeShip)return;this.moved=!0;const e=l.getBoundingClientRect(),n=(e.width-11)/10;let i=[t.clientX-this.offsetX-e.left,t.clientY-this.offsetY-e.top];const o=[Math.floor(.5+(i[0]-1)/(n+1)),Math.floor(.5+(i[1]-1)/(n+1))];o[0]=Math.max(0,Math.min(o[0],9)),o[1]=Math.max(0,Math.min(o[1],9)),x.publish("is-possible-to-move",{id:Number(this.activeShip.dataset.id),position:o})[0]?(i=[o[0]*n+1*(o[0]+1),o[1]*n+1*(o[1]+1)],this.activeShip.classList.contains("snapping")||this.activeShip.classList.add("snapping")):this.activeShip.classList.contains("snapping")&&this.activeShip.classList.remove("snapping"),this.activeShip.style.left=`${i[0]}px`,this.activeShip.style.top=`${i[1]}px`}),document.addEventListener("pointerup",t=>{if(_.state!=_.STATES.BOARD_CHOICE)return;if(!this.activeShip)return;if(!this.moved)if(x.publish("is-possible-to-rotate",Number(this.activeShip.dataset.id))[0])x.publish("rotate",Number(this.activeShip.dataset.id));else{this.activeShip.classList.add("error");const t=this.activeShip;setTimeout(()=>{t.classList.remove("error")},500)}this.activeShip.classList.remove("dragging"),this.activeShip.classList.contains("snapping")&&this.activeShip.classList.remove("snapping"),this.activeShip.releasePointerCapture(t.pointerId);const e=l.getBoundingClientRect(),n=(e.width-11)/10;let i=[t.clientX-this.offsetX-e.left,t.clientY-this.offsetY-e.top],o=[Math.floor(.5+(i[0]-1)/(n+1)),Math.floor(.5+(i[1]-1)/(n+1))];if(o[0]=Math.max(0,Math.min(o[0],9)),o[1]=Math.max(0,Math.min(o[1],9)),x.publish("is-possible-to-move",{id:Number(this.activeShip.dataset.id),position:o})[0])x.publish("move",{id:Number(this.activeShip.dataset.id),position:o});else{o=this.activeShipPos.slice(),this.activeShip.classList.add("error");const t=this.activeShip;setTimeout(()=>{t.classList.remove("error")},500)}i=[o[0]*n+1*(o[0]+1),o[1]*n+1*(o[1]+1)],this.activeShip.style.left=`${i[0]}px`,this.activeShip.style.top=`${i[1]}px`,this.activeShip=null,this.activeShipPos=null}),x.subscribe("gameover",e=>{for(_.changeState(_.STATES.GAMEOVER);n.firstChild;)n.removeChild(n.firstChild);const i=document.createElement("div");i.textContent=`Player ${e.id} has won in ${e.turn} turns!`;const o=document.createElement("div");o.textContent='Start another game by clicking "Play"',n.append(i,o),this.openModal(t)})}openModal(t){null===this.global_modal&&(this.global_modal=t,this.modal_backdrop.setAttribute("open",""),this.modal_div.setAttribute("open",""),this.global_modal.setAttribute("open",""))}closeModal(){this.modal_backdrop.removeAttribute("open"),this.modal_div.removeAttribute("open"),this.global_modal.removeAttribute("open"),this.global_modal=null}},(new class{constructor(){this.player1=new S(1,!1,new y([])),this.player2=new S(2,!0,new y([])),_.addEnterCallback(_.STATES.BOARD_CHOICE,()=>{this.player1.turn=1,this.player2.turn=1,this.player1.gameboard.reset(),this.player2.gameboard.reset(),x.publish("refresh",this)}),_.addLeaveCallback(_.STATES.BOARD_CHOICE,()=>{this.randomizeGameboard(2,new v([4,3,2,1])),x.publish("refresh",this)}),window.addEventListener("resize",()=>{x.publish("refresh",this)}),x.subscribe("randomize",()=>{this.randomizeGameboard(1,new v([4,3,2,1])),x.publish("refresh",this)}),x.subscribe("is-possible-to-move",({id:t,position:e})=>this.player1.gameboard.isPossibleToMoveShip(t,e)),x.subscribe("is-possible-to-rotate",t=>this.player1.gameboard.isPossibleToRotateShip(t)),x.subscribe("move",({id:t,position:e})=>{this.player1.gameboard.moveShip(t,e)}),x.subscribe("rotate",t=>{this.player1.gameboard.rotateShip(t),x.publish("refresh",this)}),x.subscribe("get-position",t=>this.player1.gameboard.getShipPosition(t)),x.subscribe("select_player1",({i:t,j:e})=>{_.changeState(_.STATES.PLAYER2_TURN),this.player1.turn+=1,this.hit(1,[e,t]),this.player2.gameboard.areAllShipsDestroyed()?x.publish("gameover",this.player1):(x.publish("remove-board-callback",{i:t,j:e}),x.publish("refresh",this),setTimeout(()=>{const t=this.player2.selectHit(this.player1.gameboard);x.publish("select_player2",{i:t[0],j:t[1]})},100+400*Math.random()))}),x.subscribe("select_player2",({i:t,j:e})=>{_.changeState(_.STATES.PLAYER1_TURN),this.player2.turn+=1,this.hit(2,[e,t]),this.player1.gameboard.areAllShipsDestroyed()?x.publish("gameover",this.player2):x.publish("refresh",this)})}randomizeGameboard(t,e){(1===t?this.player1.gameboard:this.player2.gameboard).randomize(new v(e.ship_amount.slice()))}hit(t,e){(1===t?this.player2.gameboard:this.player1.gameboard).hit(e)}}).randomizeGameboard(1,new v([4,3,2,1])),_.changeState(_.STATES.BOARD_CHOICE)})();